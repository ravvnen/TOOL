@startuml UseCases
title Use Case Diagram - TOOL System

left to right direction
skinparam backgroundColor #FEFEFE
skinparam packageStyle rectangle

actor "User\n(via Agent.UI)" as USER
actor "GitHub" as GH <<system>>

rectangle "TOOL System" {

    package "Chat & Memory" <<Rectangle>> {
        usecase "Chat with LLM\n(rules injected)" as UC_CHAT #LightGreen
        usecase "Compile Memory\nfor prompt" as UC_COMPILE #LightGreen
        usecase "Search Rules\n(FTS5)" as UC_SEARCH #LightGreen
        usecase "View Provenance\n(/why)" as UC_WHY #LightGreen
    }

    package "Rule Management" <<Rectangle>> {
        usecase "Create Rule" as UC_CREATE #LightGreen
        usecase "Update Rule" as UC_UPDATE #LightGreen
        usecase "Delete Rule" as UC_DELETE #LightGreen
        usecase "Seed from Git" as UC_SEED #LightGreen
    }

    package "State & Debug" <<Rectangle>> {
        usecase "View System State\n(hash, count)" as UC_STATE #LightGreen
        usecase "Browse All Items" as UC_ITEMS #LightGreen
        usecase "View Item Detail\n(history, sources)" as UC_DETAIL #LightGreen
    }

    package "Audit & Replay" <<Rectangle>> {
        usecase "Trigger Replay\n(H3 verification)" as UC_REPLAY #LightGreen
        usecase "Compare Hashes\n(SRA check)" as UC_VERIFY #LightGreen
    }

    package "Planned Features" <<Rectangle>> {
        usecase "SSE Notifications\n(H4 freshness)" as UC_SSE #LightYellow
        usecase "Multi-Instance\n(H5 consistency)" as UC_MULTI #LightYellow
        usecase "RAG/Vector Search\n(H2 comparison)" as UC_RAG #LightYellow
    }
}

' User interactions
USER --> UC_CHAT
USER --> UC_COMPILE
USER --> UC_SEARCH
USER --> UC_WHY
USER --> UC_CREATE
USER --> UC_UPDATE
USER --> UC_DELETE
USER --> UC_STATE
USER --> UC_ITEMS
USER --> UC_DETAIL
USER --> UC_REPLAY
USER --> UC_VERIFY

' GitHub webhook
GH --> UC_SEED : POST /api/v1/seed

' Relationships
UC_CHAT ..> UC_COMPILE : <<include>>
UC_VERIFY ..> UC_REPLAY : <<include>>
UC_VERIFY ..> UC_STATE : <<include>>

legend right
  |= Color |= Status |
  | <#LightGreen> | Implemented |
  | <#LightYellow> | Planned |
endlegend

note as N1
  **Single User Persona**
  The User interacts with TOOL
  through Agent.UI (React frontend)
  for all operations: chat, admin,
  debug, and replay verification.
end note

@enduml
